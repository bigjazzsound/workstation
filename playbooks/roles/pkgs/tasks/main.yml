---
- name: Fedora package tasks
  block:
    - name: Enable chrome repo
      yum_repository:
        name: google-chrome
        description: Google Chrome Repository
        baseurl: http://dl.google.com/linux/chrome/rpm/stable/$basearch
        gpgcheck: 1
        gpgkey: https://dl.google.com/linux/linux_signing_key.pub
        enabled: True

    - name: Enable fedy
      yum_repository:
        name: fedy
        description: Fedy Repository
        baseurl: https://dl.folkswithhats.org/fedora/$releasever/
        gpgcheck: 0
        enabled: True

    - name: Enable VSCode repo
      yum_repository:
        name: code
        description: Visual Studio Code
        baseurl: https://packages.microsoft.com/yumrepos/vscode
        enabled: True
        gpgcheck: True
        gpgkey: https://packages.microsoft.com/keys/microsoft.asc

    - name: Setup RPM Fusion Repos
      dnf:
        name:
          - "https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-{{ ansible_distribution_version }}.noarch.rpm"
          - "https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-{{ ansible_distribution_version }}.noarch.rpm"

    - name: Enable Kubernetes
      yum_repository:
        name: kubernetes
        file: kubernetes
        description: Kubernetes
        baseurl: https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
        enabled: True
        gpgcheck: True
        repo_gpgcheck: True
        gpgkey:
          - https://packages.cloud.google.com/yum/doc/yum-key.gpg
          - https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg

    - name: update repo
      dnf: name="*" state=latest
      register: repo_data

    - debug: var=repo_data
      when: repo_data.changed

    - name: install pkgs
      dnf:
        name:
          - bash
          - bash-completion
          - tmux
          - htop
          - nmap
          - pavucontrol
          - redshift
          - git
          - qbittorrent
          - curl
          - docker-compose
          - weechat
          - vim-enhanced
          - xclip
          - chromium
          - docker
          - "@Virtualization"
          - libguestfs-tools-c
          - python2
          - python2-pip
          - python2-devel
          - python3
          - python3-pip
          - python3-devel
          - python2-libselinux
          - python3-libselinux
          - golang
          - neovim
          - google-chrome-stable
        state: present
      register: installed_packages

    - debug: var=installed_packages
      when: installed_packages.changed
  when: ansible_distribution == 'Fedora'

- name: Ubuntu package tasks
  block:
    - name: Install apt packages
      apt:
        pkg: "{{item}}"
        state: present
      with_items:
        - bash
        - bash-completion
        - tmux
        - htop
        - nmap
        - pavucontrol
        - redshift
        - git
        - qbittorrent
        - curl
        - docker-compose
        - weechat
        - vim
        - xclip
        - chromium-browser
        - docker.io
        - python2
        - python2-pip
        - python2-dev
        - python3
        - python3-pip
        - python3-dev
        - golang
        - neovim
        - google-chrome-stable
    - name: Update and upgrade apt packages
      apt:
        update_cache: yes
        upgrade: yes
        cache_valid_time: 86400
  when: ansible_distribution == 'Ubuntu'

- name: Install Minikube
  get_url:
    url: https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
    dest: /usr/local/bin/minikube
    checksum: sha256:dfe361f86288a4cedcdc3bffbbe5b4716c7ee19cbb82d70696b0f20596a15c65
    mode: 0775

- name: Install docker-machine
  get_url:
    url: https://github.com/docker/machine/releases/download/v0.15.0/docker-machine-Linux-x86_64
    dest: /usr/local/bin/docker-machine
    checksum: sha256:44c5c62db13b6eb6a9d3e276c1181401c78327ff6303570936ba2cf5d137b7b5
    mode: 0775

- name: Install docker-machine KVM driver
  get_url:
    url: https://github.com/kubernetes/minikube/releases/download/v0.28.0/docker-machine-driver-kvm2
    dest: /usr/local/bin/docker-machine-driver-kvm2
    mode: 0775
